<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>

<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <p>This add-in will insert 'Hello world!' in the current selection of the slide.</p>
    <button id="helloButton">Say hello</button>
</body>

<script>
    Office.onReady((info) => {
        // Check that we loaded into PowerPoint
        if (info.host === Office.HostType.PowerPoint) {
            document.getElementById("helloButton").onclick = sayHello;
        }
    });

    async function sayHello() {

        // Set coercion type to text since 
        const options = { coercionType: Office.CoercionType.Text };

        await simulateWebCall()

        // clear current selection
        await Office.context.document.setSelectedDataAsync(" ", options);

        // Set text in selection to 'Hello world!'
        await Office.context.document.setSelectedDataAsync("Hello world!", options);
    }

    async function simulateWebCall() {
  try {
    console.log("Simulating web call...");

    const response = await fetch(
      "https://mpbf122a5f57f1bfad75.free.beeceptor.com/delaytest",
      {
        method: "GET",
        headers: {
          "Accept": "application/json"
        }
      }
    );

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }

    const result = await response.text(); // Beeceptor usually returns text
    console.log("Web call result:", result);

  } catch (error) {
    console.error("Web call failed:", error);
  }
}

</script>

</html>
